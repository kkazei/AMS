<div class="dashboard-container">
  <!-- Top Header -->
  <div class="header">
    <div class="user-info">
      <h1>{{ userProfile?.fullname }} </h1>
      <p>Room: {{ tenant.room || 'Not Assigned' }}</p>
    </div>
    <div class="balance-info">
      <p>Outstanding Balance</p>
      <h1>â‚±{{ tenant.rent || 0 }}</h1>
      <p>Due Date: {{ tenant.due_date | date: 'MMMM dd, yyyy' }}</p>
      <button class="pay-now-btn" (click)="togglePaymentForm()">Pay Now</button>
    </div>
  </div>

  <div *ngIf="isPaymentFormVisible" class="payment-details-wrapper">
    <form (ngSubmit)="onPayInvoice()">
      <!-- Payment Method Section -->
      <div class="payment-method-wrapper">
        <h3>Scan or Save this QR Code to Pay</h3>
        <div class="qr-payment-section">
          <div class="qr-code-section">
            <div *ngIf="imageInfos && imageInfos.length > 0">
              <div *ngFor="let image of imageInfos" class="qr-image-wrapper">
                <img [src]="image.img" alt="QR Code" class="qr-code-img" />
                <p class="qr-description">{{ image.description }}</p>
              </div>
            </div>
          </div>
          <div class="attachment-section">
            <h3>Add Attachment</h3>
            <label
              for="proofOfPayment"
              class="attachment-upload"
              [ngClass]="{ 'with-preview': paymentProofPreview }"
            >
              <ng-container *ngIf="!paymentProofPreview; else imagePreview">
                Add Attachment
              </ng-container>
              <ng-template #imagePreview>
                <img
                  [src]="paymentProofPreview"
                  alt="Payment Proof Preview"
                  class="attachment-preview-img"
                />
              </ng-template>
            </label>
            <input
              type="file"
              (change)="onPaymentProofFileSelected($event)"
              id="proofOfPayment"
              name="proofOfPayment"
              class="attachment-input"
            />
            <label for="referenceNumber" class="reference-label">Reference Number</label>
            <input
              type="text"
              id="referenceNumber"
              [(ngModel)]="paymentReferenceNumber"
              name="referenceNumber"
              class="reference-input"
            />
            <button type="submit" class="submit-btn">Send Proof of Payment</button>
          </div>
        </div>
      </div>
    </form>
    <p *ngIf="paymentMessage">{{ paymentMessage }}</p>
  </div>
  
  <!-- Tenant Grid Section -->
  <div *ngIf="!isPaymentFormVisible" class="tenant-grid-container">
    <div class="grid-container">
      <button class="grid-item" (click)="openProfileModal()">
        <i class="material-icons">person</i>
        <p>Announcements</p>
      </button>
      <button class="grid-item" (click)="openPayHistoryModal()">
        <i class="material-icons">receipt</i>
        <p>Payment History</p>
      </button>
      <button class="grid-item" (click)="openLeaseModal()">
        <i class="material-icons">home</i>
        <p>Lease Agreement</p>
      </button>
      <button class="grid-item" (click)="openConcernsModal()">
        <i class="material-icons">mail</i>
        <p>Inquiries</p>
      </button>
    </div>
    <!-- Modal For Concerns -->
<div class="modal" id="ConcernsModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h2>Create a New Concern</h2>
        <button type="button" class="btn-close" (click)="closeConcernsModal()">x</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <form (ngSubmit)="createConcern()">
          <div class="form-group">
            <label for="subject">Subject</label>
            <input
              type="text"
              id="subject"
              required
              class="form-control"
              placeholder="Subject"
              [(ngModel)]="concerntitle"
              name="subject"
              #subjectInput="ngModel"
            />
            <div *ngIf="subjectInput.invalid && subjectInput.touched" class="error-message">
              Subject is required.
            </div>
          </div>
          <div class="form-group">
            <label for="description">Description</label>
            <textarea
              id="description"
              required
              class="form-control"
              placeholder="Description"
              [(ngModel)]="concerncontent"
              name="description"
              #descriptionInput="ngModel"
            ></textarea>
            <div *ngIf="descriptionInput.invalid && descriptionInput.touched" class="error-message">
              Description is required.
            </div>
          </div>
          <div class="form-group">
            <label for="attachment">Attachment</label>
            <input
              type="file"
              id="attachment"
              class="form-control"
              (change)=" onImageFileSelected($event)"
            />
          </div>
          <button type="submit" class="btn btn-primary" [disabled]="!concerntitle || !concerncontent">
            Submit Concern
          </button>
        </form>
        <p *ngIf="message">{{ message }}</p>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>
<!--End of Concerns Modal-->

<!-- Modal For Announcements -->
<div class="modal" id="ProfileModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h2>Announcements</h2>
        <button type="button" class="btn-close" (click)="closeProfileModal()">x</button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <!-- Announcements Section -->
        <div class="card shadow">
          <div class="card-header bg-gradient-dark text-white">
            <h5 class="mb-0"><i class="bi bi-megaphone"></i> Latest Announcements</h5>
          </div>
          <div class="card-body">
            <div *ngIf="posts?.length; else noPosts">
              <div class="row">
                <div class="col-md-4" *ngFor="let post of posts">
                  <div class="card mb-3">
                    <div class="card-body">
                      <h5 class="post-title">{{ post.title }}</h5>
                      <p class="post-date">{{ post.created_at | date:'short' }}</p>
                      <p class="post-content">{{ post.content }}</p>

                      <!-- Post Image Section -->
                      <div *ngIf="post.image_path">
                        <img [src]="post.image_path" alt="Post Image" class="post-image" />
                      </div>

                      <!-- Print Button (if applicable) -->
                      <button type="button" class="btn btn-outline-primary btn-sm" >
                        <i class="bi bi-printer"></i> View
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noPosts>
              <p class="text-center text-muted">No announcements available.</p>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer"></div>
    </div>
  </div>
</div>
<!--End of Announcement Modal-->

<!-- Modal For Lease -->
<div class="modal" id="LeaseModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h2>Lease Agreement</h2>
        <button type="button" class="btn-close" (click)="closeLeaseModal()">x</button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <!-- Lease Images Section -->
        <div class="card shadow">
          <div class="card-header bg-gradient-dark text-white">
            <h5 class="mb-0"><i class="bi bi-images"></i> Lease Images</h5>
          </div>
          <div class="card-body">
            <div *ngIf="leaseImages?.length; else noImages">
              <div class="row">
                <div class="col-md-4" *ngFor="let image of leaseImages">
                  <div class="card mb-3">
                    <img
                      [src]="image.img"
                      class="card-img-top lease-image"
                      alt="Lease Image"
                    />
                    <div class="card-body">
                      <p class="card-text">{{ image.description || 'No description' }}</p>
                      <!-- Print Button -->
                      <button
                        type="button"
                        class="btn btn-outline-primary btn-sm"
                        (click)="printImage(image.img)"
                      >
                        <i class="bi bi-printer"></i> Print
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noImages>
              <p class="text-center text-muted">No lease images available.</p>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer"></div>
    </div>
  </div>
</div>

<!--End of Lease Modal-->

<!-- Modal For Pay History -->
<div class="modal" id="PayHistoryModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h2>Payment History</h2>
        <button type="button" class="btn-close" (click)="closePayHistoryModal()">x</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <!-- Payment Details Section -->
        <div class="card shadow">
          <div class="card-header bg-gradient-dark text-white">
            <h5 class="mb-0"><i class="bi bi-receipt"></i> Payment Details</h5>
          </div>
          <div class="card-body">
            <div *ngIf="paymentDetails?.length; else noPayments">
              <div class="table-responsive">
                <table class="table table-hover table-striped table-bordered align-middle">
                  <thead class="bg-light text-dark">
                    <tr>
                      <th>Tenant Name</th>
                      <th>Room</th>
                      <th>Amount</th>
                      <th>Reference Number</th>
                      <th>Proof of Payment</th>
                      <th>Payment Date</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let payment of paymentDetails">
                      <td>{{ payment.tenant_fullname }}</td>
                      <td>{{ payment.room || 'N/A' }}</td>
                      <td>â‚±{{ payment.amount }}</td>
                      <td>{{ payment.reference_number || 'N/A' }}</td>
                      <td>
                        <a
                          *ngIf="payment.proof_of_payment"
                          [href]="payment.proof_of_payment"
                          target="_blank"
                          class="btn btn-outline-primary btn-sm"
                        >
                          <i class="bi bi-eye"></i> View
                        </a>
                        <span *ngIf="!payment.proof_of_payment" class="text-danger">No Proof</span>
                      </td>
                      <td>{{ payment.payment_date | date: 'short' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <ng-template #noPayments>
              <p class="text-center text-muted">No payment records available.</p>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>
<!--End of Pay History Modal-->

    </div>
  </div>
