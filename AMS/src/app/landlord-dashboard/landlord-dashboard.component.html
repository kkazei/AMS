<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2>UnitPay Solutions</h2>
    </div>
    <nav class="sidebar-menu">
      <ul>
        <li class="active"><a href="#">Dashboard</a></li>
        <li><a href="#">Tenant Profile</a></li>
        <li><a href="#">Lease Agreement</a></li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="content">
    <!-- Dashboard Header -->
    <header class="header">
      <h1>Welcome, {{ userProfile?.fullname }}</h1>
      <span class="date">{{ currentDate }}</span>
    </header>

    <!-- Main Overview Section -->
    <section class="main-overview">
      <div class="overview-grid">
        <button class="overview-card" (click)="openTenantModal()"><i class="fa-solid fa-user"></i><br>TENANTS</button>             
        <button class="overview-card" (click)="openRoomModal()"><i class="fa-solid fa-house"></i><br>ROOMS</button>
        <button class="overview-card" (click)="openConcernsModal()"><i class="fa-solid fa-envelope"></i><br>CONCERNS</button>
        <button class="overview-card" (click)="openAnnouncementsModal()"><i class="fa-solid fa-bullhorn"></i><br>ANNOUNCEMENTS</button>
      </div>

      <!-- Modal For Tenant -->
<div class="modal" id="TenantModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Assign Tenant to a Room</h4>
        <button type="button" class="btn-close" (click)="closeTenantModal()"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <form class="assign-tenant-form" (ngSubmit)="assignTenantToApartment()">
          <!-- Select Apartment -->
          <div class="form-group">
            <label for="apartment">Select Apartment</label>
            <select id="apartment" required class="form-control" [(ngModel)]="selectedApartmentId" name="apartment">
              <option *ngFor="let apartment of apartments" [value]="apartment.apartment_id">
                {{ apartment.room }} ({{ apartment.description }})
              </option>
            </select>
          </div>

          <!-- Select Tenant -->
          <div class="form-group">
            <label for="tenant">Select Tenant</label>
            <select id="tenant" required class="form-control" [(ngModel)]="selectedTenantId" name="tenant">
              <option *ngFor="let tenant of tenants" [value]="tenant.tenant_id">
                {{ tenant.tenant_fullname }}
              </option>
            </select>
          </div>

          <!-- Action Buttons -->
          <div class="form-group">
            <button type="button" class="btn btn-primary" (click)="updateApartmentAndTenant('assign_tenant')">
              Assign Tenant
            </button>
            <button type="button" class="btn btn-warning" (click)="updateApartmentAndTenant('remove_tenant')">
              Remove Tenant
            </button>
          </div>
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <div class="tenants-list">
          <h2>Tenant List</h2>
          <div *ngIf="tenants && tenants.length; else noTenants">
            <ul>
              <li *ngFor="let tenant of tenants">
                <strong>{{ tenant.tenant_fullname }}</strong><br />
                <em>Email:</em> {{ tenant.tenant_email }}<br />
                <em>Tenant ID:</em> {{ tenant.tenant_id }}<br />
                <em>Room:</em> {{ tenant.room ? tenant.room : 'Not Assigned' }}
              </li>
            </ul>
          </div>
          <ng-template #noTenants>
            <p>No tenants found.</p>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>


      <!--Modal For Room-->
      <div class="modal" id="RoomModal">
        <div class="modal-dialog">
          <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Assign Tenant to a Room</h4>
              <button type="button" class="btn-close" (click)="closeRoomModal()"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
              <form (ngSubmit)="createApartment()">
                <!-- Apartment Room -->
                <div class="form-group">
                  <input type="text" id="room" required class="form-control" placeholder="Apartment Room"
                    [(ngModel)]="room" name="room" #roomInput="ngModel" />
                  <div *ngIf="roomInput.invalid && roomInput.touched" class="error-message">
                    Room is required.
                  </div>
                </div>

                <!-- Rent Amount -->
                <div class="form-group">
                  <input type="number" id="rent" required class="form-control" placeholder="Rent Amount"
                    [(ngModel)]="rent" name="rent" #rentInput="ngModel" />
                  <div *ngIf="rentInput.invalid && rentInput.touched" class="error-message">
                    Rent is required.
                  </div>
                </div>

                <!-- Apartment Description -->
                <div class="form-group">
                  <textarea id="description" required class="form-control" placeholder="Apartment Description"
                    [(ngModel)]="description" name="description" #descriptionInput="ngModel"></textarea>
                  <div *ngIf="descriptionInput.invalid && descriptionInput.touched" class="error-message">
                    Description is required.
                  </div>
                </div>

                <!-- Submit Button -->
                <div class="form-group">
                  <button class="btn btn-primary" type="submit"
                    [disabled]="roomInput.invalid || rentInput.invalid || descriptionInput.invalid">
                    Create Apartment
                  </button>
                </div>
              </form>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
              <div class="apartments-list-container">
                <h2 class="text-center my-4">Apartment List</h2>
                <div *ngIf="apartments && apartments.length; else noApartments" class="apartments-list">
                  <div *ngFor="let apartment of apartments" class="card shadow-sm mb-3">
                    <div class="card-body">
                      <h3 class="card-title text-primary">{{ apartment.room }}</h3>
                      <p class="card-text">Rent: ${{ apartment.rent }}</p>
                      <p class="card-text">{{ apartment.description }}</p>
                      <p class="card-text">
                        <strong>Status:</strong>
                        <span class="{{ apartment.tenant_id ? 'text-danger' : 'text-success' }}">
                          {{ apartment.tenant_id ? 'Occupied' : 'Available' }}
                        </span>
                      </p>
                    </div>
                  </div>
                </div>
                <ng-template #noApartments>
                  <p class="text-center text-muted">No apartments available.</p>
                </ng-template>
              </div>
            </div>

          </div>
        </div>
      </div>
      <!--End of Room Modal-->

      <!--Modal For Announcements-->
      <div class="modal" id="AnnouncementsModal">
        <div class="modal-dialog">
          <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Create an Announcement</h4>
              <button type="button" class="btn-close" (click)="closeAnnouncementsModal()"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
              <form class="create-post-form" (ngSubmit)="createPost()">
                <!-- Post Title -->
                <div class="form-group">
                  <input
                    type="text"
                    id="posttitle"
                    required
                    class="form-control"
                    placeholder="Enter Post Title"
                    [(ngModel)]="title"
                    name="posttitle"
                    #titleInput="ngModel"
                  />
                  <div *ngIf="titleInput.invalid && titleInput.touched" class="error-message">
                    Title is required.
                  </div>
                </div>
          
                <!-- Post Content -->
                <div class="form-group">
                  <textarea
                    id="postcontent"
                    required
                    class="form-control"
                    placeholder="Enter Post Content"
                    [(ngModel)]="content"
                    name="postcontent"
                    #contentInput="ngModel"
                  ></textarea>
                  <div *ngIf="contentInput.invalid && contentInput.touched" class="error-message">
                    Content is required.
                  </div>
                </div>
          
                <!-- Image Upload -->
                <div class="form-group">
                  <input
                    type="file"
                    id="postimage"
                    class="form-control"
                    (change)="onFileSelected($event)"
                  />
                </div>
          
                <!-- Submit Button -->
                <div class="form-group">
                  <button
                    class="btn btn-primary"
                    type="submit"
                    [disabled]="titleInput.invalid || contentInput.invalid"
                  >
                    Create Post
                  </button>
                </div>
              </form>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">

            </div>

          </div>
        </div>
      </div>
      <!--End of Announcements Modal-->

   <!-- Income and Expense Chart -->
<div class="chart-section">
  <div class="chart-container">
    <h3>Overview of 2024</h3>
    <canvas id="income-expense-chart"></canvas>
  </div>
  <div class="summary">
    <div class="summary-item vacant">{{ vacantCount }}<br>Vacant</div>
    <div class="summary-item acquired">{{ acquiredCount }}<br>Acquired</div>
    <div class="summary-item income">Php{{ totalIncome }}<br>Income</div>  <!-- Dynamic Income -->
    <div class="summary-item expenses">Php300k<br>Expenses</div>
  </div>
  
</div>




    </section>

    <!-- Invoices Section -->
    <section class="invoices">
      <h3>Invoices</h3>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Room</th>
            <th>Transaction</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tenant of tenants">
            <td>{{ tenant.tenant_fullname }}</td>
            <td>₱{{ tenant.rent }}</td>
            <td>{{ tenant.due_date | date }}</td>
            <td>{{ tenant.room }}</td>
            <td>{{ tenant.transaction || 'N/A' }}</td>
            <td [class]="tenant.status">{{ tenant.status }}</td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>
</div>