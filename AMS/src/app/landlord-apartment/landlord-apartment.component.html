<div class="landlord-dashboard">
  <!-- Assign Tenant Section -->
  <div class="assign-tenant-form-wrapper">
    <h2>Manage Apartment Assignments</h2>
    <form class="assign-tenant-form" (ngSubmit)="assignTenantToApartment()">
      <!-- Select Apartment -->
      <div class="form-group">
        <label for="apartment">Select Apartment</label>
        <select
          id="apartment"
          required
          class="form-control"
          [(ngModel)]="selectedApartmentId"
          name="apartment"
        >
          <option *ngFor="let apartment of apartments" [value]="apartment.apartment_id">
            {{ apartment.room }} ({{ apartment.description }})
          </option>
        </select>
      </div>

      <!-- Select Tenant -->
      <div class="form-group">
        <label for="tenant">Select Tenant</label>
        <select
          id="tenant"
          required
          class="form-control"
          [(ngModel)]="selectedTenantId"
          name="tenant"
        >
          <option *ngFor="let tenant of tenants" [value]="tenant.tenant_id">
            {{ tenant.tenant_fullname }}
          </option>
        </select>
      </div>

      <!-- Action Buttons -->
      <div class="form-group">
        <button
          type="button"
          class="btn btn-primary"
          (click)="updateApartmentAndTenant('assign_tenant')"
        >
          Assign Tenant
        </button>
        <button
          type="button"
          class="btn btn-warning"
          (click)="updateApartmentAndTenant('remove_tenant')"
        >
          Remove Tenant
        </button>
      </div>
    </form>
  </div>

  <!-- Displaying Apartments -->
  <div class="apartments-list">
    <h2>Apartment List</h2>
    <div *ngIf="apartments && apartments.length; else noApartments">
      <div *ngFor="let apartment of apartments" class="apartment-item">
        <h3>{{ apartment.room }}</h3>
        <p>Rent: ${{ apartment.rent }}</p>
        <p>{{ apartment.description }}</p>
        <p>
          <strong>Status:</strong>
          {{ apartment.tenant_id ? 'Occupied' : 'Available' }}
        </p>
      </div>
    </div>
    <ng-template #noApartments>
      <p>No apartments available.</p>
    </ng-template>
  </div>

  <!-- Displaying Tenants -->
  <div class="tenants-list">
    <h2>Tenant List</h2>
    <div *ngIf="tenants && tenants.length; else noTenants">
      <ul>
        <li *ngFor="let tenant of tenants">
          <strong>{{ tenant.tenant_fullname }}</strong><br />
          <em>Email:</em> {{ tenant.tenant_email }}<br />
          <em>Tenant ID:</em> {{ tenant.tenant_id }}<br />
          <em>Room:</em> {{ tenant.room ? tenant.room : 'Not Assigned' }}
        </li>
      </ul>
    </div>
    <ng-template #noTenants>
      <p>No tenants found.</p>
    </ng-template>
  </div>

  <!-- Create Post Section -->
  <div class="create-post-form-wrapper">
    <h2>Create a New Post</h2>
    <form class="create-post-form" (ngSubmit)="createPost()">
      <!-- Post Title -->
      <div class="form-group">
        <input
          type="text"
          id="posttitle"
          required
          class="form-control"
          placeholder="Enter Post Title"
          [(ngModel)]="title"
          name="posttitle"
          #titleInput="ngModel"
        />
        <div *ngIf="titleInput.invalid && titleInput.touched" class="error-message">
          Title is required.
        </div>
      </div>

      <!-- Post Content -->
      <div class="form-group">
        <textarea
          id="postcontent"
          required
          class="form-control"
          placeholder="Enter Post Content"
          [(ngModel)]="content"
          name="postcontent"
          #contentInput="ngModel"
        ></textarea>
        <div *ngIf="contentInput.invalid && contentInput.touched" class="error-message">
          Content is required.
        </div>
      </div>

      <!-- Image Upload -->
      <div class="form-group">
        <input
          type="file"
          id="postimage"
          class="form-control"
          (change)="onFileSelected($event)"
        />
      </div>

      <!-- Submit Button -->
      <div class="form-group">
        <button
          class="btn btn-primary"
          type="submit"
          [disabled]="titleInput.invalid || contentInput.invalid"
        >
          Create Post
        </button>
      </div>
    </form>
  </div>

  <!-- Create Apartment Section -->
  <div class="create-apartment-form-wrapper">
    <h2>Create a New Apartment</h2>
    <form (ngSubmit)="createApartment()">
      <!-- Apartment Room -->
      <div class="form-group">
        <input
          type="text"
          id="room"
          required
          class="form-control"
          placeholder="Apartment Room"
          [(ngModel)]="room"
          name="room"
          #roomInput="ngModel"
        />
        <div *ngIf="roomInput.invalid && roomInput.touched" class="error-message">
          Room is required.
        </div>
      </div>

      <!-- Rent Amount -->
      <div class="form-group">
        <input
          type="number"
          id="rent"
          required
          class="form-control"
          placeholder="Rent Amount"
          [(ngModel)]="rent"
          name="rent"
          #rentInput="ngModel"
        />
        <div *ngIf="rentInput.invalid && rentInput.touched" class="error-message">
          Rent is required.
        </div>
      </div>

      <!-- Apartment Description -->
      <div class="form-group">
        <textarea
          id="description"
          required
          class="form-control"
          placeholder="Apartment Description"
          [(ngModel)]="description"
          name="description"
          #descriptionInput="ngModel"
        ></textarea>
        <div *ngIf="descriptionInput.invalid && descriptionInput.touched" class="error-message">
          Description is required.
        </div>
      </div>

      <!-- Submit Button -->
      <div class="form-group">
        <button
          class="btn btn-primary"
          type="submit"
          [disabled]="roomInput.invalid || rentInput.invalid || descriptionInput.invalid"
        >
          Create Apartment
        </button>
      </div>
    </form>
  </div>

  <!-- Display Posts -->
  <div *ngIf="posts && posts.length" class="posts-list">
    <h2>Posts</h2>
    <div *ngFor="let post of posts">
      <h3>{{ post.title }}</h3>
      <p>{{ post.content }}</p>
      <div *ngIf="post.image_path">
        <img [src]="post.image_path" alt="Post Image" class="post-image" />
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-8">
    <label class="btn btn-default p-0">
      <input type="file" (change)="onFileSelected($event)" />
    </label>
  </div>

  <div class="col-4">
    <button (click)="upload()">Upload</button>
  </div>
</div>

<div>
  <img [src]="preview" class="preview" *ngIf="preview" />
</div>

<div *ngIf="message" class="alert alert-secondary" role="alert">
  {{ message }}
</div>

<div class="card" *ngIf="imageInfos && imageInfos.length > 0">
  <div class="card-header">List of Images</div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item" *ngFor="let image of imageInfos; trackBy: trackByFn">
      <p><a [href]="image.img">{{ image.imgName }}</a></p>
      <img [src]="image.img" [alt]="image.imgName" height="80px" />
    </li>
  </ul>
</div>

<div *ngIf="!imageInfos || imageInfos.length === 0">
  No images found.
</div>

<div class="pay-invoice-form-wrapper">
  <h2>Pay Invoice</h2>
  <form (ngSubmit)="onPayInvoice()">
    <!-- Tenant Selection -->
    <div class="form-group">
      <label for="tenant">Select Tenant</label>
      <select
        id="tenant"
        required
        class="form-control"
        [(ngModel)]="paymentTenantId"
        name="paymentTenantId"
      >
        <option *ngFor="let tenant of tenants" [value]="tenant.tenant_id">
          {{ tenant.tenant_fullname }}
        </option>
      </select>
    </div>

    <!-- Payment Amount -->
    <div class="form-group">
      <label for="amount">Amount</label>
      <input
        type="number"
        id="amount"
        required
        class="form-control"
        [(ngModel)]="paymentAmount"
        name="amount"
      />
    </div>

    <!-- Reference Number -->
    <div class="form-group">
      <label for="referenceNumber">Reference Number</label>
      <input
        type="text"
        id="referenceNumber"
        class="form-control"
        [(ngModel)]="paymentReferenceNumber"
        name="referenceNumber"
      />
    </div>

    <!-- Proof of Payment -->
    <div class="form-group">
      <label for="proofOfPayment">Upload Proof of Payment</label>
      <input
        type="file"
        id="proofOfPayment"
        class="form-control"
        (change)="onFileSelected($event)"
      />
    </div>

    <!-- Submit Button -->
    <div class="form-group">
      <button type="submit" class="btn btn-primary" [disabled]="!paymentTenantId || !paymentAmount">
        Submit Payment
      </button>
    </div>
  </form>

  <div *ngIf="paymentMessage" class="alert alert-secondary">
    {{ paymentMessage }}
  </div>
</div>



